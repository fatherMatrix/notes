# rwsem

## 优化

| Upstream Commit ID | Subject (Upper, Newer)                                                     |                                                                                                                                                                                                        |
| ------------------ | -------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| cf48647243cc       | Documentation: seqlock: s/LOCKTYPE/LOCKNAME/g                              |                                                                                                                                                                                                        |
| 617f3ef95177       | locking/rwsem: Remove reader optimistic spinning                           | 有了reader steal，没必要进行reader spin                                                                                                                                                                        |
| 1a728dff855a       | locking/rwsem: Enable reader optimistic lock stealing                      | 增加了reader steal                                                                                                                                                                                        |
| 2f06f702925b       | locking/rwsem: Prevent potential lock starvation                           | 此时reader spin还存在，其导致handoff bit没有机会设置，进而饿死了wait list上等待的writer。（handoff bit只能在wait list上的waiter被唤醒时才有机会设置）<br/>为了避免持续到来地reader使waiter饿死，当reader发现此时是reader持锁，且有多个reader在临界区内，则把自己放入wait list。（反直觉，反优化） |
| c8fe8b056438       | locking/rwsem: Pass the current atomic count to rwsem_down_read_slowpath() |                                                                                                                                                                                                        |
| c995e638ccbb       | locking/rwsem: Fold __down_{read,write}*()                                 |                                                                                                                                                                                                        |
| 285c61aedf6b       | locking/rwsem: Introduce rwsem_write_trylock()                             |                                                                                                                                                                                                        |
| 3379116a0ca9       | locking/rwsem: Better collate rwsem_read_trylock()                         |                                                                                                                                                                                                        |

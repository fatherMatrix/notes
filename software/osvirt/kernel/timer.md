# 时间子系统

两种定时器：

- 低分辨率定时器（经典定时器）
  - 周期性
- 高分辨率定时器
  - 非周期性，可发生在任何时间点
  - 进程统计
  - jiffies

## clocksource - 时钟源

时钟源抽象，该接口允许读取时钟芯片提供的运行计数器的当前值

- **TSC**是每个CPU内部的一个计数器，它按CPU主频以固定频率递增，例如一个2400Mhz的CPU，计数器每秒逐一增加2400M个计数值。计数器在CPU启动时初始化为零，假设我们已知CPU启动时刻，那么只要把当前计算器的值除以频率再加上启动时刻，就可以得知当前时间了。
- **RTC**是位于CMOS电路中的一个计时设备，它与TSC相比的优点是有独立的电池供电，即使计算机下电，RTC计时器仍可以继续工作；缺点是计数频率较低，因此时间精度较差。通常我们初始时将RTC计数器的值设置为当前时刻相对于1970年1月1日的时间差，因此通过RTC提供的寄存器接口，我们可以直接获取到当前时间。
- **ACPI_PM**通常是南桥中的APCI电源管理模块提供的计时设备，其精度较低，通常不推荐使用。

## clock_event_device/tick_device - 时钟事件源

时钟事件，用于触发编程中断：

- **Local APIC Timer**是每个CPU的本地中断控制器(APIC)内部的定时设备，精度较高，是系统正常运行时采用的通知设备。
- **PIT**是CPU之外的独立定时通知设备，属全局设备，精度较低，通常不使用。
- **HPET**也是全局定时通知设备，精度较高，需要系统中含专属硬件。
- **RTC**还包含一个闹钟事件，irq为8。这个字符设备更多的是提供给用户一个制定闹钟（大时间粒度）的功能，与上面三个不冲突，也不能称之为时钟事件源。
  - devm_rtc_device_register
  - cmos_interrupt
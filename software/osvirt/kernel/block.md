# Block Layer

## 磁盘结构

```
                                                                                                                bdev_inode <-----------------+ 
                                                                                                             +--------------+                |
       +-------------------> block_device (disk) <---+ <----------------------------------------+----------- | block_device |--bd_inode--+   |
       |                     +-----------------+     |                                          |            +--------------+            |   |
       |                     |                 |     |                                          |            |     inode    | <----------+   |
       |                     +-----------------+     |                          /----------\    |            +--------------+                |
       |                     |  bd_containers  |-----+                          | bdev_map |    |                                            |
       |                     +-----------------+                                \----------/    |            /---------------------\         |
       |                     |    bd_disk      |                                      |         +-bd_super-> | blockdev_superblock |         |
       |    /------\         +-----------------+                                      v                      \---------------------/         |
       |    | NULL | <-------|    bd_part      |                                  kobj_map                                                   |
       |    \------/         +-----------------+                               +------------+                                                |
       |                     |                 |                               |            |                                                |
       |                     +-----------------+                               +------------+                                                |
       |                                                                       |  probe[0]  |------> probe    +--> probe    +--> probe       |
       |                                                                       +------------+      +-------+  |  +-------+  |  +-------+     |
       |                                                                       |  probe[1]  |      | next  |--+  | next  |--+  | next  |     |
       |                                                                       +------------+      +-------+     +-------+     +-------+     |
       |                                                                       |   ......   |      |       |     |       |     | dev_t |-----+
       |                                                                       +------------+      +-------+     +-------+     +-------+
       |                                                                       | probe[255] |                                  | data  |-----+ 
       |                                                                       +------------+                                  +-------+     |
       |                                                                       |            |                                  |       |     |
       |                                                                       +------------+                                  +-------+     |
       |                                                                                                                                     |
       |                                                                                                                                     |
       |                                                                                                                                     |
       |                                                                                                                                     |
       |                                             gendisk <-------------------------------------------------------------------------------+
       |                                         +-------------+
       |                                         |             |
       |                                         +-------------+
```
